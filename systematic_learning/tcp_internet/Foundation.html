<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>线程池监控仪表盘</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  
  <!-- 配置Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36CFC9',
            success: '#52C41A',
            warning: '#FAAD14',
            danger: '#FF4D4F',
            dark: '#1D2129',
            'dark-light': '#272E3B',
            'dark-lighter': '#343D4E',
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }
      .stat-card {
        @apply bg-dark-light rounded-xl p-5 transition-all duration-300 hover:shadow-lg hover:scale-[1.02] card-shadow;
      }
      .animate-pulse-slow {
        animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
    }
  </style>
</head>
<body class="bg-dark text-gray-200 font-inter min-h-screen">
  <!-- 顶部导航 -->
  <header class="bg-dark-lighter shadow-md fixed top-0 left-0 right-0 z-50 transition-all duration-300">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <div class="flex items-center space-x-3">
        <i class="fa fa-tasks text-primary text-2xl"></i>
        <h1 class="text-xl font-bold">线程池监控仪表盘</h1>
      </div>
      
      <div class="flex items-center space-x-6">
        <div class="hidden md:flex items-center space-x-2">
          <span id="pool-status-badge" class="px-3 py-1 rounded-full text-sm font-medium bg-success/20 text-success">
            <i class="fa fa-check-circle mr-1"></i>运行中
          </span>
          <span id="update-time" class="text-gray-400 text-sm">最后更新: 刚刚</span>
        </div>
        
        <button id="refresh-btn" class="p-2 rounded-full hover:bg-dark transition-colors">
          <i class="fa fa-refresh text-gray-300"></i>
        </button>
        
        <button id="settings-btn" class="p-2 rounded-full hover:bg-dark transition-colors">
          <i class="fa fa-cog text-gray-300"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="container mx-auto px-4 pt-24 pb-16">
    <!-- 状态概览 -->
    <section class="mb-8">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5">
        <!-- 线程状态卡片 -->
        <div class="stat-card">
          <div class="flex justify-between items-start mb-3">
            <div>
              <p class="text-gray-400 text-sm">当前线程数</p>
              <h3 id="current-threads" class="text-2xl font-bold">12</h3>
            </div>
            <div class="p-2 bg-primary/20 rounded-lg">
              <i class="fa fa-microchip text-primary"></i>
            </div>
          </div>
          <div class="flex justify-between items-center text-sm">
            <span>核心线程: <span id="core-threads" class="text-secondary">8</span></span>
            <span>峰值: <span id="peak-threads" class="text-warning">16</span></span>
          </div>
        </div>
        
        <!-- 任务状态卡片 -->
        <div class="stat-card">
          <div class="flex justify-between items-start mb-3">
            <div>
              <p class="text-gray-400 text-sm">活跃任务</p>
              <h3 id="active-tasks" class="text-2xl font-bold">8</h3>
            </div>
            <div class="p-2 bg-secondary/20 rounded-lg">
              <i class="fa fa-list-alt text-secondary"></i>
            </div>
          </div>
          <div class="flex justify-between items-center text-sm">
            <span>完成: <span id="completed-tasks" class="text-success">247</span></span>
            <span>队列中: <span id="pending-tasks" class="text-warning">3</span></span>
          </div>
        </div>
        
        <!-- 吞吐量卡片 -->
        <div class="stat-card">
          <div class="flex justify-between items-start mb-3">
            <div>
              <p class="text-gray-400 text-sm">吞吐量 (任务/秒)</p>
              <h3 id="throughput" class="text-2xl font-bold">16.8</h3>
            </div>
            <div class="p-2 bg-success/20 rounded-lg">
              <i class="fa fa-tachometer text-success"></i>
            </div>
          </div>
          <div class="flex justify-between items-center text-sm">
            <span>峰值: <span id="peak-throughput" class="text-success">24.3</span></span>
            <span>队列利用率: <span id="queue-utilization" class="text-secondary">32%</span></span>
          </div>
        </div>
        
        <!-- 错误统计卡片 -->
        <div class="stat-card">
          <div class="flex justify-between items-start mb-3">
            <div>
              <p class="text-gray-400 text-sm">错误与取消</p>
              <h3 id="failed-tasks" class="text-2xl font-bold">0</h3>
            </div>
            <div class="p-2 bg-danger/20 rounded-lg">
              <i class="fa fa-exclamation-triangle text-danger"></i>
            </div>
          </div>
          <div class="flex justify-between items-center text-sm">
            <span>取消: <span id="cancelled-tasks" class="text-warning">2</span></span>
            <span>错误率: <span id="error-rate" class="text-danger">0%</span></span>
          </div>
        </div>
      </div>
    </section>
    
    <!-- 图表区域 -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
      <!-- 吞吐量趋势图 -->
      <div class="bg-dark-light rounded-xl p-5 card-shadow">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold">吞吐量趋势</h2>
          <div class="flex space-x-2">
            <button class="time-filter-btn px-3 py-1 text-xs rounded-full bg-dark-lighter hover:bg-primary/20 transition-colors active">
              实时
            </button>
            <button class="time-filter-btn px-3 py-1 text-xs rounded-full bg-dark-lighter hover:bg-primary/20 transition-colors">
              1小时
            </button>
            <button class="time-filter-btn px-3 py-1 text-xs rounded-full bg-dark-lighter hover:bg-primary/20 transition-colors">
              24小时
            </button>
          </div>
        </div>
        <div class="h-64">
          <canvas id="throughput-chart"></canvas>
        </div>
      </div>
      
      <!-- 线程与任务趋势图 -->
      <div class="bg-dark-light rounded-xl p-5 card-shadow">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold">线程与任务数</h2>
          <div class="flex space-x-2">
            <button class="px-3 py-1 text-xs rounded-full bg-primary/20 text-primary">
              <i class="fa fa-download mr-1"></i>导出
            </button>
          </div>
        </div>
        <div class="h-64">
          <canvas id="threads-tasks-chart"></canvas>
        </div>
      </div>
    </section>
    
    <!-- 任务列表和配置信息 -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- 任务列表 -->
      <div class="lg:col-span-2 bg-dark-light rounded-xl p-5 card-shadow">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold">活跃任务列表</h2>
          <div class="flex items-center space-x-2">
            <div class="relative">
              <input type="text" placeholder="搜索任务ID" class="bg-dark rounded-lg px-3 py-1 text-sm pl-8 focus:outline-none focus:ring-1 focus:ring-primary">
              <i class="fa fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 text-sm"></i>
            </div>
            <select class="bg-dark rounded-lg px-3 py-1 text-sm focus:outline-none focus:ring-1 focus:ring-primary">
              <option>所有状态</option>
              <option>运行中</option>
              <option>等待中</option>
              <option>已完成</option>
              <option>已取消</option>
              <option>失败</option>
            </select>
          </div>
        </div>
        
        <div class="overflow-x-auto">
          <table class="min-w-full">
            <thead>
              <tr class="border-b border-gray-700">
                <th class="py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">任务ID</th>
                <th class="py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">类型</th>
                <th class="py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">状态</th>
                <th class="py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">提交时间</th>
                <th class="py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">运行时间</th>
                <th class="py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">操作</th>
              </tr>
            </thead>
            <tbody id="tasks-table-body" class="divide-y divide-gray-700">
              <!-- 任务行示例 -->
              <tr class="hover:bg-dark-lighter transition-colors">
                <td class="py-3 text-sm">task_1024</td>
                <td class="py-3 text-sm"><span class="px-2 py-0.5 rounded text-xs bg-primary/20 text-primary">普通任务</span></td>
                <td class="py-3 text-sm"><span class="px-2 py-0.5 rounded text-xs bg-success/20 text-success">运行中</span></td>
                <td class="py-3 text-sm">10:24:36</td>
                <td class="py-3 text-sm">00:00:12</td>
                <td class="py-3 text-sm">
                  <button class="text-danger hover:text-danger/80 mr-3"><i class="fa fa-stop"></i></button>
                  <button class="text-secondary hover:text-secondary/80"><i class="fa fa-info-circle"></i></button>
                </td>
              </tr>
              <tr class="hover:bg-dark-lighter transition-colors">
                <td class="py-3 text-sm">task_1023</td>
                <td class="py-3 text-sm"><span class="px-2 py-0.5 rounded text-xs bg-warning/20 text-warning">优先级任务</span></td>
                <td class="py-3 text-sm"><span class="px-2 py-0.5 rounded text-xs bg-warning/20 text-warning">等待中</span></td>
                <td class="py-3 text-sm">10:24:18</td>
                <td class="py-3 text-sm">-</td>
                <td class="py-3 text-sm">
                  <button class="text-danger hover:text-danger/80 mr-3"><i class="fa fa-stop"></i></button>
                  <button class="text-secondary hover:text-secondary/80"><i class="fa fa-info-circle"></i></button>
                </td>
              </tr>
              <tr class="hover:bg-dark-lighter transition-colors">
                <td class="py-3 text-sm">task_1022</td>
                <td class="py-3 text-sm"><span class="px-2 py-0.5 rounded text-xs bg-secondary/20 text-secondary">延迟任务</span></td>
                <td class="py-3 text-sm"><span class="px-2 py-0.5 rounded text-xs bg-success/20 text-success">运行中</span></td>
                <td class="py-3 text-sm">10:23:52</td>
                <td class="py-3 text-sm">00:00:48</td>
                <td class="py-3 text-sm">
                  <button class="text-danger hover:text-danger/80 mr-3"><i class="fa fa-stop"></i></button>
                  <button class="text-secondary hover:text-secondary/80"><i class="fa fa-info-circle"></i></button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="flex justify-between items-center mt-4 text-sm text-gray-400">
          <div>显示 1-8 项，共 24 项</div>
          <div class="flex space-x-1">
            <button class="w-8 h-8 flex items-center justify-center rounded hover:bg-dark-lighter disabled:opacity-50" disabled>
              <i class="fa fa-chevron-left"></i>
            </button>
            <button class="w-8 h-8 flex items-center justify-center rounded bg-primary text-white">1</button>
            <button class="w-8 h-8 flex items-center justify-center rounded hover:bg-dark-lighter">2</button>
            <button class="w-8 h-8 flex items-center justify-center rounded hover:bg-dark-lighter">3</button>
            <button class="w-8 h-8 flex items-center justify-center rounded hover:bg-dark-lighter">
              <i class="fa fa-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>
      
      <!-- 配置信息和事件日志 -->
      <div class="space-y-6">
        <!-- 配置信息 -->
        <div class="bg-dark-light rounded-xl p-5 card-shadow">
          <h2 class="text-lg font-semibold mb-4">线程池配置</h2>
          <div class="space-y-3 text-sm">
            <div class="flex justify-between pb-2 border-b border-gray-700">
              <span class="text-gray-400">最小线程数</span>
              <span id="config-min-threads">4</span>
            </div>
            <div class="flex justify-between pb-2 border-b border-gray-700">
              <span class="text-gray-400">最大线程数</span>
              <span id="config-max-threads">20</span>
            </div>
            <div class="flex justify-between pb-2 border-b border-gray-700">
              <span class="text-gray-400">核心线程数</span>
              <span id="config-core-threads">8</span>
            </div>
            <div class="flex justify-between pb-2 border-b border-gray-700">
              <span class="text-gray-400">队列策略</span>
              <span id="config-queue-policy">优先级队列</span>
            </div>
            <div class="flex justify-between pb-2 border-b border-gray-700">
              <span class="text-gray-400">最大队列大小</span>
              <span id="config-max-queue-size">1000</span>
            </div>
            <div class="flex justify-between pb-2 border-b border-gray-700">
              <span class="text-gray-400">扩展策略</span>
              <span id="config-expansion">动态扩展</span>
            </div>
            <div class="flex justify-between pb-2 border-b border-gray-700">
              <span class="text-gray-400">监控间隔</span>
              <span id="config-monitoring-interval">100ms</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-400">任务超时</span>
              <span id="config-task-timeout">30s</span>
            </div>
          </div>
          
          <button class="mt-5 w-full py-2 rounded-lg bg-primary hover:bg-primary/90 transition-colors text-sm font-medium">
            修改配置
          </button>
        </div>
        
        <!-- 事件日志 -->
        <div class="bg-dark-light rounded-xl p-5 card-shadow">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold">事件日志</h2>
            <button class="text-xs text-gray-400 hover:text-gray-300">
              清空日志
            </button>
          </div>
          
          <div id="event-log" class="space-y-2 max-h-64 overflow-y-auto pr-2 text-sm">
            <div class="flex items-start">
              <span class="text-xs text-gray-500 min-w-[80px]">10:25:32</span>
              <span class="text-gray-300"><span class="text-primary">[lifecycle]</span> 线程池运行中</span>
            </div>
            <div class="flex items-start">
              <span class="text-xs text-gray-500 min-w-[80px]">10:25:18</span>
              <span class="text-gray-300"><span class="text-secondary">[task_submitted]</span> Task task_1024 提交成功</span>
            </div>
            <div class="flex items-start">
              <span class="text-xs text-gray-500 min-w-[80px]">10:24:56</span>
              <span class="text-gray-300"><span class="text-success">[scheduler]</span> 线程池已扩展至12线程</span>
            </div>
            <div class="flex items-start">
              <span class="text-xs text-gray-500 min-w-[80px]">10:24:30</span>
              <span class="text-gray-300"><span class="text-warning">[task_cancelled]</span> Task task_1021 已取消</span>
            </div>
            <div class="flex items-start">
              <span class="text-xs text-gray-500 min-w-[80px]">10:24:05</span>
              <span class="text-gray-300"><span class="text-primary">[lifecycle]</span> 线程池已启动，初始线程数8</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    // 模拟数据更新
    function updateMetrics() {
      // 随机波动当前值，但保持在合理范围内
      const currentThreads = Math.floor(8 + Math.random() * 6);
      const activeTasks = Math.floor(5 + Math.random() * 5);
      const pendingTasks = Math.floor(Math.random() * 5);
      const completedTasks = 247 + Math.floor(Math.random() * 3);
      const throughput = (15 + Math.random() * 5).toFixed(1);
      const failedTasks = Math.floor(Math.random() * 2);
      const cancelledTasks = 2 + Math.floor(Math.random() * 2);
      const queueUtilization = Math.floor(25 + Math.random() * 20) + '%';
      
      // 更新DOM
      document.getElementById('current-threads').textContent = currentThreads;
      document.getElementById('active-tasks').textContent = activeTasks;
      document.getElementById('pending-tasks').textContent = pendingTasks;
      document.getElementById('completed-tasks').textContent = completedTasks;
      document.getElementById('throughput').textContent = throughput;
      document.getElementById('failed-tasks').textContent = failedTasks;
      document.getElementById('cancelled-tasks').textContent = cancelledTasks;
      document.getElementById('queue-utilization').textContent = queueUtilization;
      
      // 更新最后更新时间
      const now = new Date();
      document.getElementById('update-time').textContent = `最后更新: ${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
      
      // 添加新的事件日志
      addEventLog('task_update', `任务状态更新: 活跃=${activeTasks}, 等待=${pendingTasks}`);
      
      // 更新图表
      updateCharts(currentThreads, activeTasks + pendingTasks, parseFloat(throughput));
    }
    
    // 添加事件日志
    function addEventLog(category, message) {
      const logContainer = document.getElementById('event-log');
      const now = new Date();
      const timeStr = `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
      
      // 根据类别选择颜色
      let categoryClass = 'text-gray-400';
      switch(category) {
        case 'lifecycle': categoryClass = 'text-primary'; break;
        case 'task_submitted': case 'task_completed': categoryClass = 'text-secondary'; break;
        case 'scheduler': categoryClass = 'text-success'; break;
        case 'task_cancelled': categoryClass = 'text-warning'; break;
        case 'error': categoryClass = 'text-danger'; break;
      }
      
      const logEntry = document.createElement('div');
      logEntry.className = 'flex items-start';
      logEntry.innerHTML = `
        <span class="text-xs text-gray-500 min-w-[80px]">${timeStr}</span>
        <span class="text-gray-300"><span class="${categoryClass}">[${category}]</span> ${message}</span>
      `;
      
      // 添加到顶部
      logContainer.insertBefore(logEntry, logContainer.firstChild);
      
      // 限制日志数量
      if (logContainer.children.length > 20) {
        logContainer.removeChild(logContainer.lastChild);
      }
    }
    
    // 初始化图表
    let throughputChart, threadsTasksChart;
    let throughputData = [];
    let threadsData = [];
    let tasksData = [];
    let timeLabels = [];
    
    function initCharts() {
      // 初始化数据
      const now = new Date();
      for (let i = 10; i >= 0; i--) {
        const time = new Date(now - i * 1000);
        timeLabels.push(`${time.getMinutes().toString().padStart(2, '0')}:${time.getSeconds().toString().padStart(2, '0')}`);
        throughputData.push(15 + Math.random() * 5);
        threadsData.push(8 + Math.random() * 4);
        tasksData.push(5 + Math.random() * 5);
      }
      
      // 吞吐量图表
      const throughputCtx = document.getElementById('throughput-chart').getContext('2d');
      throughputChart = new Chart(throughputCtx, {
        type: 'line',
        data: {
          labels: timeLabels,
          datasets: [{
            label: '吞吐量 (任务/秒)',
            data: throughputData,
            borderColor: '#165DFF',
            backgroundColor: 'rgba(22, 93, 255, 0.1)',
            borderWidth: 2,
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              mode: 'index',
              intersect: false
            }
          },
          scales: {
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.05)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.5)'
              }
            },
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(255, 255, 255, 0.05)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.5)'
              }
            }
          }
        }
      });
      
      // 线程与任务图表
      const threadsTasksCtx = document.getElementById('threads-tasks-chart').getContext('2d');
      threadsTasksChart = new Chart(threadsTasksCtx, {
        type: 'line',
        data: {
          labels: timeLabels,
          datasets: [
            {
              label: '线程数',
              data: threadsData,
              borderColor: '#36CFC9',
              backgroundColor: 'transparent',
              borderWidth: 2,
              tension: 0.4,
              yAxisID: 'y'
            },
            {
              label: '任务数',
              data: tasksData,
              borderColor: '#FAAD14',
              backgroundColor: 'transparent',
              borderWidth: 2,
              tension: 0.4,
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                color: 'rgba(255, 255, 255, 0.7)'
              }
            }
          },
          scales: {
            x: {
              grid: {
                color: 'rgba(255, 255, 255, 0.05)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.5)'
              }
            },
            y: {
              type: 'linear',
              display: true,
              position: 'left',
              title: {
                display: true,
                text: '线程数',
                color: 'rgba(255, 255, 255, 0.7)'
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.05)'
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.5)'
              }
            },
            y1: {
              type: 'linear',
              display: true,
              position: 'right',
              title: {
                display: true,
                text: '任务数',
                color: 'rgba(255, 255, 255, 0.7)'
              },
              grid: {
                drawOnChartArea: false
              },
              ticks: {
                color: 'rgba(255, 255, 255, 0.5)'
              }
            }
          }
        }
      });
    }
    
    // 更新图表数据
    function updateCharts(threads, tasks, throughput) {
      // 添加新数据点
      const now = new Date();
      const timeStr = `${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
      
      // 移除最旧的数据点
      if (throughputData.length >= 10) {
        throughputData.shift();
        threadsData.shift();
        tasksData.shift();
        timeLabels.shift();
      }
      
      // 添加新数据
      throughputData.push(throughput);
      threadsData.push(threads);
      tasksData.push(tasks);
      timeLabels.push(timeStr);
      
      // 更新图表
      throughputChart.data.labels = timeLabels;
      throughputChart.data.datasets[0].data = throughputData;
      throughputChart.update();
      
      threadsTasksChart.data.labels = timeLabels;
      threadsTasksChart.data.datasets[0].data = threadsData;
      threadsTasksChart.data.datasets[1].data = tasksData;
      threadsTasksChart.update();
    }
    
    // 页面加载完成后初始化
    document.addEventListener('DOMContentLoaded', function() {
      // 初始化图表
      initCharts();
      
      // 定时更新数据
      setInterval(updateMetrics, 2000);
      
      // 刷新按钮
      document.getElementById('refresh-btn').addEventListener('click', function() {
        this.classList.add('animate-spin');
        updateMetrics();
        setTimeout(() => {
          this.classList.remove('animate-spin');
        }, 500);
      });
      
      // 时间过滤器按钮
      const timeFilterBtns = document.querySelectorAll('.time-filter-btn');
      timeFilterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          timeFilterBtns.forEach(b => b.classList.remove('active', 'bg-primary/20', 'text-primary'));
          this.classList.add('active', 'bg-primary/20', 'text-primary');
        });
      });
      
      // 滚动时导航栏效果
      window.addEventListener('scroll', function() {
        const header = document.querySelector('header');
        if (window.scrollY > 10) {
          header.classList.add('py-2');
          header.classList.remove('py-3');
        } else {
          header.classList.add('py-3');
          header.classList.remove('py-2');
        }
      });
    });
  </script>
</body>
</html>